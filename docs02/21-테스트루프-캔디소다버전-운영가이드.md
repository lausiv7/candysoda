# 21. 테스트 루프 캔디소다 버전 운영 가이드

**문서 버전**: 1.0.0  
**작성일**: 2025-08-05  
**프로젝트**: Sweet Puzzle 캔디소다 Phase 1  
**문서 분류**: 운영 가이드  

## 📋 문서 개요

### 목적 (Purpose)
본 문서는 Sweet Puzzle 캔디소다 게임의 Phase 1 구현에 특화된 테스트 자동화 및 리페어 루프 시스템의 운영 가이드입니다. 기존 테스트 리페어 루프 시스템을 기반으로 캔디소다 게임에 최적화된 설정과 운영 방법을 제시합니다.

### 범위 (Scope)
- Sweet Puzzle 게임 특화 테스트 설정 및 실행
- 캔디소다 게임 로직 검증을 위한 E2E 테스트 시나리오
- 게임 특화 에러 패턴 인식 및 자동 수정
- Playwright 기반 다중 브라우저 테스트 지원
- 실시간 스크린샷 캡처 및 HTML 대시보드 리포팅

### 캔디소다 프로젝트 특징
- **게임 장르**: 3매치 퍼즐 게임 (Match-3 Puzzle)
- **기술 스택**: HTML5/CSS3/JavaScript + Playwright E2E
- **테스트 대상**: 블록 시스템, 매치 감지, 중력 시스템, 연쇄 반응
- **플랫폼**: 다중 브라우저 (Chrome, Firefox, Safari, 모바일)

---

## 🎯 캔디소다 테스트 시스템 아키텍처

### 시스템 구성도

```
Sweet Puzzle Test Architecture
┌─────────────────────────────────────────────────────┐
│                   Test Runner                       │
│  ┌─────────────────┐  ┌─────────────────────────┐   │
│  │ Config Manager  │  │   Repair Engine         │   │
│  │ - Game Config   │  │ - Game-specific Fixes   │   │
│  │ - Browser Setup │  │ - Pattern Recognition   │   │
│  └─────────────────┘  └─────────────────────────┘   │
└─────────────────────────────────────────────────────┘
           │                            │
           ▼                            ▼
┌─────────────────┐           ┌──────────────────┐
│  Playwright     │           │   Auto Repair    │
│  Test Suite     │◄──────────┤   System         │
│  - Game Tests   │           │  - Error Analysis│
│  - Screenshots  │           │  - Code Fixes    │
│  - Videos       │           │  - Retry Logic   │
└─────────────────┘           └──────────────────┘
           │
           ▼
┌─────────────────────────────────────────────────────┐
│              Report Dashboard                       │
│  ┌─────────────┐  ┌─────────────┐  ┌──────────────┐ │
│  │ HTML Report │  │ JSON History│  │ Screenshots  │ │
│  │ - Test Results│ │ - Sessions  │  │ - Visual     │ │
│  │ - Metrics   │  │ - Trends    │  │   Evidence   │ │
│  └─────────────┘  └─────────────┘  └──────────────┘ │
└─────────────────────────────────────────────────────┘
```

### 핵심 컴포넌트

#### 1. 게임 특화 설정 (`sweet-puzzle-config.json`)
```json
{
  "project": {
    "name": "sweet-puzzle",
    "version": "phase-1"
  },
  "gameSpecific": {
    "gameStateCheck": "window.game && window.game.gameState === 'player_turn'",
    "boardSelector": "#game-board",
    "blockSelector": ".candy",
    "expectedBlocks": 64
  }
}
```

#### 2. 테스트 실행기 (`run-sweet-puzzle-tests.js`)
- 기존 테스트 리페어 루프 시스템 활용
- 캔디소다 게임 특화 에러 패턴 인식
- 자동 수정 및 재시도 로직

#### 3. E2E 테스트 스위트 (`tests/sweet-puzzle-e2e.spec.js`)
- 9개 카테고리 68개 테스트 케이스
- 게임 초기화부터 완전한 게임 세션까지
- 다중 브라우저 및 모바일 테스트

---

## 🚀 설치 및 초기 설정

### 1. 환경 요구사항
- **Node.js**: v18.0.0 이상
- **Python**: v3.8 이상 (HTTP 서버용)
- **운영체제**: Windows, macOS, Linux 지원

### 2. 프로젝트 초기화
```bash
# 캔디소다 프로젝트 디렉토리로 이동
cd /path/to/sweet-puzzle/app

# 의존성 설치
npm install

# Playwright 브라우저 설치
npx playwright install
```

### 3. 설정 파일 확인
```bash
# 설정 파일 존재 확인
ls -la sweet-puzzle-config.json playwright.config.js

# 게임 파일 확인
ls -la index.html src/js/puzzle/
```

---

## 🎮 캔디소다 테스트 실행

### 1. 기본 테스트 실행
```bash
# 전체 테스트 스위트 실행 (자동 수정 포함)
node run-sweet-puzzle-tests.js

# 수동 Playwright 테스트만 실행
npx playwright test

# 특정 브라우저만 테스트
npx playwright test --project=chromium
```

### 2. 테스트 모드별 실행

#### 🔄 자동 리페어 모드 (기본)
```bash
node run-sweet-puzzle-tests.js
```
- 최대 3회 시도
- 실패 시 자동으로 코드 수정 후 재시도
- 성공할 때까지 반복

#### 🧪 단순 테스트 모드
```bash
npx playwright test --reporter=html
```
- 테스트만 실행, 자동 수정 없음
- HTML 리포트 생성

#### 🎥 비주얼 모드 (헤드풀)
```bash
npx playwright test --headed --project=chromium
```
- 브라우저 창을 띄워서 테스트 진행 과정 시각화

### 3. 실시간 모니터링
```bash
# 개발 서버 별도 실행
python3 -m http.server 8081

# 다른 터미널에서 테스트 실행
npx playwright test --reporter=list
```

---

## 🧩 캔디소다 게임 특화 테스트 시나리오

### 1. 게임 초기화 및 UI 테스트
```javascript
// 테스트 항목
✅ 게임 페이지 로드 및 초기 상태 확인
✅ 반응형 디자인 테스트 (데스크톱/태블릿/모바일)
✅ 게임 보드 64개 블록 렌더링 확인
✅ 점수/이동수 UI 정상 표시
```

### 2. 블록 선택 및 상호작용 테스트
```javascript
// 테스트 항목
✅ 블록 클릭 선택 기능
✅ 드래그 앤 드롭 이동
✅ 인접 블록 간 교환
✅ 유효하지 않은 이동 차단
```

### 3. 매치 감지 및 처리 테스트
```javascript
// 테스트 항목
✅ 3매치 기본 패턴 감지
✅ 4매치 특수 블록 생성
✅ L/T 모양 복합 패턴 감지
✅ 연쇄 반응 (Chain Reaction) 처리
```

### 4. 중력 시스템 테스트
```javascript
// 테스트 항목
✅ 블록 낙하 애니메이션
✅ 빈 공간 자동 채우기
✅ 새 블록 생성 로직
✅ 물리 효과 및 착지 피드백
```

### 5. 게임 플레이 통합 테스트
```javascript
// 테스트 항목
✅ 완전한 게임 세션 시뮬레이션 (30회 이동)
✅ 힌트 시스템 동작
✅ 보드 섞기 기능
✅ 게임 재시작 기능
```

---

## 🔧 자동 에러 수정 시스템

### 캔디소다 게임 특화 에러 패턴

#### 1. 게임 초기화 에러
```javascript
// 문제: window.game이 undefined
// 수정: 게임 로드 대기 시간 증가
await page.waitForFunction(() => 
  window.game && window.game.gameState === 'player_turn', 
  { timeout: 30000 }
);
```

#### 2. 엘리먼트 선택 에러
```javascript
// 문제: .candy 블록을 찾을 수 없음
// 수정: 가시성 조건 추가
- locator('.candy')
+ locator('.candy:visible')
```

#### 3. 타임아웃 에러
```javascript
// 문제: 애니메이션 대기 시간 부족
// 수정: 타임아웃 값 증가
- timeout: 60000
+ timeout: 120000
```

#### 4. 터치/드래그 이벤트 에러
```javascript
// 문제: 모바일 터치 이벤트 실패
// 수정: 터치 시뮬레이션 개선
await page.locator('.candy').first().dragTo(
  page.locator('.candy').nth(1),
  { force: true }
);
```

### 자동 수정 프로세스

1. **에러 감지**: 테스트 실패 시 에러 유형 분류
2. **패턴 매칭**: 알려진 게임 특화 에러 패턴과 비교
3. **수정 적용**: 해당하는 수정 로직 자동 실행
4. **재시도**: 수정된 코드로 테스트 재실행
5. **결과 기록**: 성공/실패 여부를 히스토리에 저장

---

## 📊 테스트 결과 및 리포팅

### 1. 실시간 HTML 대시보드

테스트 완료 후 `test-results/sweet-puzzle-dashboard.html` 파일이 생성됩니다:

```
Sweet Puzzle Dashboard Features:
┌────────────────────────────────────────┐
│  📊 메트릭 카드                        │
│  - 총 테스트 수: 68개                  │
│  - 통과율: 85.3%                       │
│  - 스크린샷: 45개                      │
└────────────────────────────────────────┘
┌────────────────────────────────────────┐
│  📸 스크린샷 갤러리                    │
│  - 카테고리별 필터링                   │
│  - 클릭하여 확대 보기                  │
│  - 타임스탬프 및 파일 크기             │
└────────────────────────────────────────┘
┌────────────────────────────────────────┐
│  📈 테스트 히스토리                    │
│  - 세션별 성공/실패 기록               │
│  - 자동 수정 시도 횟수                 │
│  - 성능 메트릭 추이                    │
└────────────────────────────────────────┘
```

### 2. JSON 히스토리 저장

모든 테스트 세션이 `test-results/sweet-puzzle-test-history.json`에 기록됩니다:

```json
{
  "sessions": [
    {
      "sessionId": "sweet-puzzle-1733401234567",
      "startTime": "2025-08-05T10:30:00.000Z",
      "finalResult": "success",
      "attempts": [
        {
          "attemptNumber": 1,
          "success": false,
          "errors": [...],
          "repairAttempted": true,
          "repairSuccess": true
        },
        {
          "attemptNumber": 2,
          "success": true,
          "screenshots": [...]
        }
      ],
      "duration": 125000
    }
  ]
}
```

### 3. 스크린샷 증거 수집

각 테스트 단계별로 자동 스크린샷 캡처:
- `00-initial-state.png`: 게임 초기 상태
- `01-1-game-loaded.png`: 게임 로드 완료
- `02-1-block-selected.png`: 블록 선택 상태
- `03-1-after-match.png`: 매치 처리 후
- `04-1-gravity-complete.png`: 중력 적용 완료
- `09-1-session-complete.png`: 게임 세션 완료

---

## 🎯 운영 및 모니터링

### 1. 일일 운영 체크리스트

#### 테스트 실행 전 확인사항
- [ ] 개발 서버 포트(8081) 사용 가능 확인
- [ ] 게임 파일 무결성 확인 (`index.html`, JS 모듈들)
- [ ] Playwright 브라우저 버전 최신화

#### 테스트 실행 중 모니터링
- [ ] 테스트 진행 상황 실시간 확인
- [ ] 에러 발생 시 자동 수정 프로세스 정상 동작
- [ ] 스크린샷 정상 캡처 여부

#### 테스트 완료 후 검토
- [ ] HTML 리포트 정상 생성 확인
- [ ] 실패한 테스트 케이스 원인 분석
- [ ] 성능 메트릭 트렌드 확인

### 2. 성능 메트릭 모니터링

#### 핵심 지표 (KPI)
- **테스트 통과율**: 목표 90% 이상
- **자동 수정 성공률**: 목표 80% 이상
- **평균 테스트 실행 시간**: 목표 5분 이하
- **메모리 사용량 증가**: 목표 10MB 이하

#### 알림 조건
- 연속 3회 테스트 실패 시
- 자동 수정이 2회 연속 실패 시  
- 테스트 실행 시간이 10분 초과 시
- 메모리 누수 감지 시

### 3. 트러블슈팅 가이드

#### 자주 발생하는 문제와 해결책

**🔴 문제**: 게임이 로드되지 않음
```bash
# 해결책 1: 포트 변경
lsof -ti:8081 | xargs kill -9
node run-sweet-puzzle-tests.js

# 해결책 2: 캐시 클리어
rm -rf node_modules/.cache
npx playwright install
```

**🔴 문제**: 블록 선택이 동작하지 않음
```bash
# 해결책: 게임 초기화 대기 시간 증가
# playwright.config.js에서 timeout 값 증가
actionTimeout: 20000
```

**🔴 문제**: 스크린샷이 생성되지 않음
```bash
# 해결책: 권한 확인
chmod -R 755 test-results/
mkdir -p test-results/screenshots
```

**🔴 문제**: 모바일 테스트 실패
```bash
# 해결책: 모바일 전용 대기 시간 적용
# 테스트 코드에서 모바일 기기 감지 후 대기시간 증가
```

### 4. 확장 및 커스터마이징

#### 새로운 테스트 케이스 추가
```javascript
// tests/sweet-puzzle-e2e.spec.js에 추가
test.describe('10. 새로운 기능 테스트', () => {
  test('10.1 새 기능 동작 확인', async ({ page }) => {
    // 테스트 로직 구현
    await page.screenshot({ 
      path: 'test-results/screenshots/10-1-new-feature.png' 
    });
  });
});
```

#### 새로운 에러 패턴 추가
```javascript
// run-sweet-puzzle-tests.js의 repairError() 함수에 추가
async repairError(error) {
  switch (error.type) {
    case 'new_error_type':
      return this.fixNewErrorType(error);
    // 기존 케이스들...
  }
}
```

#### 리포트 커스터마이징
```javascript
// scripts/generate-test-report.js 수정
// HTML 템플릿, CSS 스타일, 메트릭 계산 로직 변경 가능
```

---

## 📈 성과 측정 및 최적화

### 1. Sweet Puzzle Phase 1 테스트 결과

#### 현재 달성 지표 (2025-08-05 기준)
- ✅ **총 테스트 케이스**: 68개 (9개 카테고리)
- ✅ **다중 브라우저 지원**: Chrome, Firefox, Safari, Mobile Chrome, Mobile Safari
- ✅ **자동 스크린샷**: 45개 캡처 지점
- ✅ **자동 수정 패턴**: 4개 게임 특화 패턴 구현
- ✅ **리포트 시스템**: HTML 대시보드 + JSON 히스토리

#### 테스트 커버리지
```
Sweet Puzzle Phase 1 Test Coverage:
┌──────────────────────────┬──────────┬────────┐
│ 테스트 카테고리          │ 테스트 수│ 상태   │
├──────────────────────────┼──────────┼────────┤
│ 1. 게임 초기화 및 UI     │    12    │   ✅   │
│ 2. 블록 선택 및 상호작용 │     8    │   ✅   │  
│ 3. 매치 감지 및 처리     │    10    │   ✅   │
│ 4. 중력 시스템           │     6    │   ✅   │
│ 5. 힌트 시스템           │     4    │   ✅   │
│ 6. 게임 제어 기능        │     8    │   ✅   │
│ 7. 디버그 시스템         │     4    │   ✅   │
│ 8. 성능 및 안정성        │     8    │   ✅   │
│ 9. 통합 게임플레이       │     8    │   ✅   │
└──────────────────────────┴──────────┴────────┘
```

### 2. 최적화 권장사항

#### 단기 개선 사항 (1-2주)
1. **테스트 실행 시간 단축**
   - 병렬 실행 최적화
   - 불필요한 대기 시간 제거
   - 스크린샷 압축 적용

2. **자동 수정 정확도 향상**
   - 더 많은 에러 패턴 학습
   - 게임 상태 기반 조건부 수정
   - 롤백 메커니즘 강화

#### 중기 개선 사항 (1-2개월)
1. **Phase 2 기능 대응**
   - 특수 블록 시스템 테스트
   - 레벨 시스템 테스트
   - 사운드/음향 테스트

2. **AI 기반 테스트 생성**
   - 게임 플레이 패턴 학습
   - 자동 엣지 케이스 발견
   - 성능 병목지점 탐지

#### 장기 비전 (3-6개월)
1. **다른 게임으로 확장**
   - 범용 게임 테스트 프레임워크
   - 플러그인 아키텍처
   - 테스트 템플릿 라이브러리

2. **클라우드 기반 실행**
   - CI/CD 파이프라인 통합
   - 분산 테스트 실행
   - 실시간 대시보드

---

## 🔗 참고 자료 및 문서

### 1. 관련 문서
- `docs02/03-Puzzle-System-Design.md`: 퍼즐 시스템 상세 설계
- `docs02/test-scenarios.md`: 전체 테스트 시나리오 명세
- `test-auto-repair/docs/21 테스트 리페어 루프 설계 및 구현.md`: 기반 시스템 설계

### 2. 핵심 파일 구조
```
docs02/app/
├── sweet-puzzle-config.json          # 게임 특화 설정
├── run-sweet-puzzle-tests.js         # 테스트 실행기
├── playwright.config.js              # Playwright 설정
├── tests/
│   └── sweet-puzzle-e2e.spec.js     # E2E 테스트 스위트
├── scripts/
│   └── generate-test-report.js       # 리포트 생성기
├── src/js/puzzle/                    # 게임 로직 (테스트 대상)
│   ├── PuzzleManager.js
│   ├── GameBoard.js
│   ├── MatchDetector.js
│   ├── MoveValidator.js
│   └── GravitySystem.js
└── test-results/                     # 테스트 결과
    ├── sweet-puzzle-dashboard.html   # HTML 대시보드
    ├── sweet-puzzle-test-history.json # 테스트 히스토리
    └── screenshots/                  # 스크린샷 증거
```

### 3. 명령어 참조
```bash
# 기본 실행
node run-sweet-puzzle-tests.js

# 단일 브라우저 테스트
npx playwright test --project=chromium

# 헤드풀 모드 (시각적 확인)
npx playwright test --headed

# 리포트 확인
npx playwright show-report

# 서버 수동 실행
python3 -m http.server 8081
```

---

## 📝 버전 히스토리

| 버전 | 날짜 | 변경사항 |
|------|------|----------|
| 1.0.0 | 2025-08-05 | 초기 버전 작성 - Sweet Puzzle Phase 1 테스트 시스템 완성 |

---

**문서 승인**: Claude Code AI System  
**최종 검토**: 2025-08-05  
**다음 리뷰 예정**: Phase 2 구현 시작 시점  

---

> 💡 **운영 팁**: 이 문서는 Sweet Puzzle 게임의 성장과 함께 지속적으로 업데이트됩니다. 새로운 기능이나 테스트 케이스가 추가될 때마다 해당 섹션을 업데이트하여 최신 상태를 유지하세요.

> 🚀 **확장성**: 현재 시스템은 다른 HTML5 게임 프로젝트에서도 설정 파일만 변경하여 재사용 가능하도록 설계되었습니다. 범용성을 고려한 아키텍처를 통해 향후 다양한 게임 장르로 확장이 가능합니다.