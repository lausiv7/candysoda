# CLAUDE.md

Claude Code (claude.ai/code)가 Sweet Puzzle (캔디소다) 프로젝트에서 작업할 때 참고할 가이드입니다.

## 📋 프로젝트 헌법 및 개발 원칙

-   **전체 프로젝트의 뼈대 및 맥락 제공:** 이 문서는 Sweet Puzzle 캔디 크러시 스타일 모바일 퍼즐 게임 프로젝트의 목표, 기능, 기술 스택 등 모든 것을 정의합니다.
-   **모든 개발/설계/코드 작성의 기준점:** 새로운 기능을 추가하거나 기존 코드를 수정할 때, 이 문서를 최우선으로 참고해야 합니다.
-   **LLM 및 개발자가 반드시 준수해야 할 규칙 명시:** 아래 규칙들은 프로젝트의 일관성과 품질을 유지하기 위한 핵심 약속입니다.
    -   **명시적인 의도(주석):** 모든 주요 함수/모듈 상단에는 `[의도] ...`와 `[책임] ...` 형식으로 주석을 작성하여 의도와 책임을 명확히 해야 합니다.
    -   **헌법 준수:** 새로운 기능 개발 시 본 헌법의 설계와 원칙을 반드시 준수해야 합니다.
    -   **불확실성 명시:** 불확실하거나 논의가 필요한 부분은 `[불확실한 부분] ...` 또는 `TODO`, `FIXME` 등으로 명시하고 피드백을 요청해야 합니다.
    -   **설계 철학 준수:** Claude, ChatGPT 등 LLM은 이 문서의 설계 철학(UI/UX 가이드라인, 기술 스택 등)에서 벗어나는 코드를 생성해서는 안 됩니다.
    -   **문서 수정 원칙:** 문서 수정이나 통합 시에는 해당 항목을 업데이트하거나 새로운 항목을 추가하되, **기존 내용을 삭제해야 할 경우에는 반드시 사전에 상의 후 반영합니다.**
-   **보안 원칙:**
    -   API 키 및 민감정보는 반드시 서버사이드에서 관리, 클라이언트 노출 금지
    -   사용자 게임 데이터 및 프로필 정보는 암호화하여 저장
    -   웹 기반 게임 실행 시 보안 정책 준수 필수
-   **문서 동기화: 살아있는 기록으로서의 문서 구조**
    -   **`CLAUDE.md` (헌법 & 청사진):** 이 문서는 프로젝트의 '왜'와 '무엇'을 정의합니다. 시스템의 비전, 아키텍처, 핵심 원칙 등은 항상 이 문서를 기준으로 하며, 큰 방향성의 변경이 있을 때만 수정됩니다. 모든 참여자(기획, 개발, 디자인, AI)는 의사결정 시 이 문서를 최우선 기준으로 삼아야 합니다.
    -   **테스트 자동화 문서:** 개발 환경 구축, 테스트 실행, 특정 기능의 구체적인 구현 과정, 문제 해결 기록 등 모든 기술적 세부사항과 이력을 기록합니다.
-   **현재 상태와 목표:** 
    -   **Phase 1 완료 (2025.08.06)**: 03 퍼즐 시스템 Phase 1 구현 및 검증 완료
        - 8x8 게임보드, 3매치 로직, 중력 시스템, 특수 블록 등 핵심 퍼즐 기능 구현
        - 독립적인 테스트 자동화 환경 구축 (80개 테스트, 69% 성공률)
        - 타임스탬프 기반 테스트 결과 히스토리 관리 시스템 구축
        - GitHub 저장소 https://github.com/lausiv7/candysoda 동기화 완료
    -   **Phase 2 목표**: 04 진행 시스템(레벨, 스코어, 별점) 구현으로 진행 예정
    -   **최종 목표**: 테스트 자동화 기반의 안정적인 Sweet Puzzle 캔디 크러시 스타일 모바일 퍼즐 게임을 TypeScript/Cocos Creator로 구현
    -   **기술 전환 계획**: Phase 1에서 HTML5/JS로 검증된 로직을 TypeScript/Cocos Creator로 마이그레이션

## 프로젝트 개요

Sweet Puzzle은 캔디 크러시 스타일의 모바일 퍼즐 게임 프로젝트입니다. 3매치 퍼즐 메커니즘과 소셜 기능을 결합한 캐주얼 게임으로, 현재 설계 완료 후 구현 단계입니다.

## 프로젝트 구조

현재 설계 문서와 구현계획이 포함되어 있습니다:
- `docs02/01-Game-Design.md` - Sweet Puzzle 종합 게임 기획서
- `docs02/02-TRD.md` - 기술 요구사항 문서
- `docs02/03-Puzzle-System-Design.md` - 퍼즐 시스템 설계
- `docs02/03-Puzzle-System-Design-구현계획.md` - 퍼즐 시스템 구현계획
- `docs02/04-Progression-System-Design.md` - 진행 시스템 설계
- `docs02/04-Progression-System-Design-구현계획.md` - 진행 시스템 구현계획
- `docs02/05-Social-System-Design.md` - 소셜 시스템 설계
- `docs02/05-Social-System-Design-구현계획.md` - 소셜 시스템 구현계획
- `docs02/06-UI-UX-System-Design.md` - UI/UX 시스템 설계
- `docs02/06-UI-UX-System-Design-구현계획.md` - UI/UX 시스템 구현계획
- `docs02/07-Analytics-System-Design.md` - 분석 시스템 설계
- `docs02/07-Analytics-System-Design-구현계획.md` - 분석 시스템 구현계획
- `docs02/08-Monetization-System-Design.md` - 수익화 시스템 설계
- `docs02/08-Monetization-System-Design-구현계획.md` - 수익화 시스템 구현계획

## 개발 컨텍스트

Sweet Puzzle 캔디 크러시 스타일 모바일 퍼즐 게임의 **설계 완료 및 구현 시작 저장소**입니다:

### 게임 컨셉
- **플랫폼**: 모바일 웹 (PWA 지원)
- **장르**: 3매치 퍼즐 게임
- **기술 스택**: TypeScript/Cocos Creator 3.8+ + Node.js/Firebase
- **Phase 1 프로토타입**: HTML5/CSS3/JavaScript (로직 검증 완료)
- **타겟**: 캐주얼 게이머 (여성 25-45세 중심)
- **핵심 루프**: 퍼즐 해결 → 진행 → 보상 → 소셜 상호작용

### 주요 시스템 (설계 완료)
- **퍼즐 시스템**: 3매치 매칭, 특수 블록, 파이어볼/폭탄 시스템
- **진행 시스템**: 500+ 레벨, 별점 시스템, 일일 도전
- **소셜 시스템**: 친구 연동, 라이프 주고받기, 리더보드
- **수익화 시스템**: 아이템 상점, 무제한 라이프, 광고 시청
- **분석 시스템**: 플레이어 행동 추적, A/B 테스트, 리텐션 분석

### 테스트 자동화 통합 계획
`../test-auto-repair/` 시스템을 기반으로 한 개발 및 운영 자동화:
- **개발 환경 구축**: Docker 기반 개발 환경 + 자동 테스트
- **테스트 리페어 루프**: 게임 기능 테스트 실패 시 자동 수정
- **점진적 개선**: 03 퍼즐 시스템부터 단계별 구현 및 테스트
- **통합 테스트**: 전체 게임 시스템 통합 후 자동 테스트 실행
- **운영 모니터링**: 실시간 게임 상태 모니터링 및 자동 대응

## 개발 참고사항

- **현재 단계**: 설계 완료, 구현 시작 단계
- **구현 우선순위**: 03 퍼즐 시스템 → 04 진행 시스템 → 06 UI/UX → 기타 시스템
- **테스트 기반 개발**: 각 시스템 구현 시 자동 테스트 병행 작성
- **모바일 우선**: 터치 인터페이스와 반응형 디자인 중심
- **성능 최적화**: 60FPS 유지, 메모리 사용량 최적화

## 저장소 작업 시 주의사항

이 프로젝트 작업 시:
1. `docs02/01-Game-Design.md`에서 전체 게임 컨셉과 방향성 확인
2. `docs02/02-TRD.md`에서 기술적 요구사항과 아키텍처 이해
3. 각 시스템별 설계 문서와 구현계획 문서를 쌍으로 참조
4. 테스트 자동화 시스템(`../test-auto-repair/`)과 연동하여 개발
5. 모바일 플랫폼 특화 UX 고려사항 우선 반영

## 🔄 커밋 및 히스토리 관리 정책

### 커밋 주기 및 범위
- **큰 개발 항목이 아니더라도 중간중간 커밋**: 히스토리 분석을 통한 개선 아이디어 도출을 위해
- **세분화된 커밋**: 기능별, 컴포넌트별로 나누어 커밋하여 변경 내역 추적 용이성 확보
- **의미있는 커밋 메시지**: `[모듈명] 기능 설명 - 구체적 변경사항` 형식 권장

### 히스토리 활용 방안
- **패턴 분석**: 반복되는 문제점이나 개선 포인트 식별
- **개발 속도 측정**: 기능별 구현 소요 시간 분석
- **품질 지표**: 버그 수정 빈도, 리팩토링 패턴 추적
- **학습 자료**: 개발 과정의 시행착오를 향후 프로젝트에 활용

### 내부 저장소 관리
- **브랜치 전략**: feature/module-name 형태로 모듈별 개발 브랜치 운영
- **태그 관리**: Phase 완료 시점마다 버전 태그 생성
- **문서 동기화**: 코드 변경과 함께 관련 문서 동시 업데이트

## 테스트 자동화 및 개발 환경

### 독립적인 테스트 환경 구축
Sweet Puzzle 프로젝트는 `docs02/app/` 디렉토리 내에 독립적인 테스트 자동화 환경을 구축합니다:
- **개발 환경**: `app/dev-environment/` - Docker 기반 개발 서버 설정
- **테스트 설정**: `app/test-setup/` - 프로젝트 특화 테스트 설정
- **리포트 생성**: `app/reports/` - 개발 진행 상황과 테스트 결과
- **자동화 스크립트**: `app/scripts/` - 개발 프로세스 자동화

### 테스트 리페어 루프 시스템
상위 `../../test-auto-repair/` 시스템의 핵심 로직을 Sweet Puzzle 게임 개발에 맞게 적용:

#### 21. 테스트 리페어 루프 설계 적용
- **3가지 테스트 모드**: Semi-Auto, Auto, Interactive
- **Diff 기반 수정 제안**: Git diff 형태로 변경사항 시각화
- **지능형 실패 분석**: 퍼즐 게임 특화 실패 패턴 감지
- **자동 문서화**: 모든 수정 과정 자동 기록

#### 22. 테스트 루프 운영 가이드 적용
- **게임 환경 구축**: Docker 기반 개발 환경 설정
- **단계별 테스트**: 퍼즐 시스템부터 순차적 구현 및 검증
- **시각적 테스트**: 게임 UI 스크린샷 기반 회귀 테스트
- **성능 모니터링**: 60FPS 유지, 메모리 사용량 측정

#### 개발 환경 구축 절차
```bash
# 1. Sweet Puzzle 개발 환경 설정
cd docs02/app
./setup-sweet-puzzle-dev.sh

# 2. 퍼즐 시스템 구현 시작
./start-puzzle-system-dev.sh

# 3. 테스트 리페어 루프 활성화
./enable-test-repair-loop.sh puzzle-system

# 4. 실시간 개발 모니터링
./monitor-game-development.sh
```

### 점진적 개선 계획

#### Phase 1: 핵심 퍼즐 시스템 (현재 목표)
- **03 퍼즐 시스템 구현**: 3매치 로직, 블록 시스템, 특수 효과
- **자동 테스트 구축**: 퍼즐 매칭 로직 단위 테스트
- **시각적 검증**: 게임 화면 렌더링 테스트

#### Phase 2: 기본 게임 루프
- **04 진행 시스템 구현**: 레벨 시스템, 별점, 스코어
- **06 UI/UX 구현**: 게임 인터페이스, 애니메이션
- **통합 테스트**: 전체 게임 플로우 검증

#### Phase 3: 고급 기능
- **05 소셜 시스템**: 친구 기능, 리더보드
- **07 분석 시스템**: 플레이어 데이터 수집
- **08 수익화 시스템**: 상점, 광고 연동

### 범용성 및 모듈성 설계

#### 24. 범용 테스트 리페어 루프 MCP 서버 지향
- **모듈화된 게임 컴포넌트**: 다른 퍼즐 게임에서도 재사용 가능
- **설정 가능한 테스트 규칙**: 게임 타입별 커스텀 테스트 로직
- **플러그인 아키텍처**: 새로운 게임 장르 지원 확장
- **표준화된 게임 API**: 다양한 캐주얼 게임 개발에 활용

이 접근 방식을 통해 Sweet Puzzle은 단순한 게임 개발을 넘어 게임 개발 자동화 플랫폼의 시범 사례가 될 것입니다.

## 현재 구현 완료 상황 (2025.08.06)

### ✅ Phase 1: 03 퍼즐 시스템 구현 완료
- **핵심 게임 로직**: Block.js, GameBoard.js, MatchDetector.js, PuzzleManager.js 등 구현
- **상호작용 시스템**: 터치/드래그 기반 블록 교환, 3매치 감지, 중력 시스템
- **테스트 자동화**: 80개 테스트 케이스, 8개 Phase별 검증, 5개 브라우저 호환성 테스트
- **히스토리 관리**: JSON 기반 테스트 결과 추적, 타임스탬프 대시보드 생성

### 🔧 독립적인 테스트 시스템 구축
- **위치**: `docs02/app/` 디렉토리 내 완전 독립 운영
- **상위 시스템과의 관계**: `../test-auto-repair/` 시스템 수정 없이 Sweet Puzzle 전용 adapter 방식
- **향후 통합 계획**: 검증된 기능들을 상위 범용 MCP 서버로 역류(backport) 예정

### 📊 테스트 결과 현황
```
총 80개 테스트 실행:
- 통과: 55개 (69%)
- 실패: 25개 (31%, 대부분 timeout 관련, 게임 로직은 정상 작동)
- 브라우저별: Chromium 75%, Firefox 69%, WebKit 63%, Mobile 80%+
```

### 📁 생성된 주요 파일들
- **게임 코어**: `src/js/puzzle/` 디렉토리 내 6개 주요 클래스
- **테스트 설정**: `sweet-puzzle-config.json`, `run-sweet-puzzle-tests.js`
- **히스토리 관리**: `update-dashboard-with-history.js`, `test-results/test-history.json`
- **문서화**: `21-테스트루프-캔디소다버전-운영가이드.md`, `22-테스트루프-운영가이드-종합판.md`, `23-수동테스트방법정리-캔디소다버전.md`

## 23. 수동 테스트 방법 정리 (완료)

Phase 1 구현 완료에 따라 다음 항목들에 대한 수동 테스트 방법이 정리되었습니다:

### 퍼즐 게임 특화 테스트 항목
- **매칭 로직 검증**: 3매치, 4매치, 5매치 시나리오별 테스트
- **특수 블록 생성**: 파이어볼, 폭탄, 레인보우 블록 생성 조건 테스트
- **콤보 시스템**: 연쇄 매칭과 점수 계산 검증
- **레벨 클리어 조건**: 목표 달성 로직과 별점 시스템 테스트
- **UI 반응성**: 터치 입력, 드래그 앤 드롭, 애니메이션 품질

### 크로스 플랫폼 테스트
- **다양한 디바이스**: 스마트폰, 태블릿, 데스크톱 브라우저
- **성능 테스트**: 저사양 기기에서의 프레임률과 반응속도
- **네트워크 조건**: 오프라인 플레이, 불안정한 연결 상황

이러한 수동 테스트 가이드는 자동 테스트로 커버하기 어려운 사용자 경험 품질을 보장하는 데 중요한 역할을 할 것입니다.

## 🧪 테스트 시스템 개발 맥락 및 진화 과정

### Phase 1: 기본 테스트 자동화 구축 (완료)
**기간**: 2025.08.05~06  
**목표**: Sweet Puzzle 핵심 기능 검증 및 안정성 확보

#### 구현된 테스트 컴포넌트
- **핵심 게임 로직 테스트**: `run-sweet-puzzle-tests.js` (80개 테스트 케이스)
- **크로스 브라우저 검증**: Chromium, Firefox, WebKit, Mobile Safari/Chrome
- **Phase별 구조화**: 8개 Phase로 체계화된 테스트 분류
- **히스토리 추적**: JSON 기반 테스트 결과 누적 관리

#### 테스트 결과 현황
```
총 80개 테스트 중:
- 통과: 55개 (69%) 
- 실패: 25개 (31%, 주로 timeout 관련)
- 게임 핵심 로직: 100% 정상 작동 확인
```

### Phase 2: 시각적 테스트 시스템 구축 (완료)
**기간**: 2025.08.06  
**목표**: 개발 현황의 시각적 추적 및 모니터링

#### 혁신적 스크린샷 시스템
- **모듈별 Phase 캡처**: 3개 모듈 × 4개 Phase = 12개 항목 자동 분석
- **상태별 시각화**: 구현됨/미구현/오류 상태 차별화된 이미지 생성
- **통합 대시보드**: 전체 프로젝트 진행률 8% (1/12) 정확 표시
- **SVG 플레이스홀더**: 미구현 기능에 대한 시각적 안내

#### 개발 현황 투명성 확보
- **정확한 진행률 측정**: 과장 없는 실제 구현 상태 반영
- **우선순위 시각화**: 다음 개발할 Phase 명확히 표시
- **품질 추적**: 구현된 기능의 UI/UX 품질 스크린샷 증거

### Phase 3: 범용 MCP 서버 준비 (진행 중)
**목표**: Sweet Puzzle에서 검증된 테스트 시스템을 범용화

#### 모듈화 설계 원칙
- **프로젝트 독립성**: 각 게임/앱 프로젝트별 독립적인 테스트 환경
- **어댑터 패턴**: 상위 시스템 수정 없이 프로젝트별 특화 기능 추가
- **역류(Backport) 계획**: 검증된 기능들의 상위 시스템 통합

#### 확장 가능성
- **다양한 게임 장르**: 퍼즐 게임 외 RPG, 액션, 시뮬레이션 등 지원
- **커스터마이징 지원**: 프로젝트별 모듈/Phase 구조 유연한 설정
- **협업 도구 연동**: GitHub Actions, Slack, Discord 등 자동 리포팅

### 테스트 철학 및 방법론

#### 점진적 개선 (Progressive Enhancement)
- **최소 기능부터 시작**: 핵심 로직 우선 검증 후 고급 기능 추가
- **실패를 통한 학습**: 테스트 실패 패턴 분석으로 개선점 도출
- **지속적 통합**: 매 커밋마다 자동 테스트 실행 및 품질 추적

#### 시각적 회귀 테스트 도입
- **UI 변경 감지**: 스크린샷 비교를 통한 의도치 않은 UI 변경 탐지
- **사용자 경험 검증**: 자동화로 커버하기 어려운 UX 품질을 시각적으로 보장
- **개발자 피드백**: 실시간 시각적 피드백으로 개발 속도 및 품질 향상

### 향후 테스트 시스템 로드맵

#### 단기 (1-2개월)
- **소셜 시스템 테스트**: Module 4 추가 및 멀티플레이어 시나리오 테스트
- **성능 테스트**: 메모리 사용량, 프레임률, 로딩 시간 자동 측정
- **접근성 테스트**: 스크린 리더, 키보드 네비게이션, 색맹 지원 검증

#### 중기 (3-6개월)
- **AI 기반 테스트**: 머신러닝을 활용한 사용자 행동 패턴 시뮬레이션
- **클라우드 테스트**: 다양한 실제 디바이스에서의 자동 테스트 실행
- **A/B 테스트 연동**: 기능 변경의 사용자 반응 자동 측정

#### 장기 (6개월 이상)
- **범용 게임 테스트 플랫폼**: 다양한 게임 장르 지원하는 MCP 서버 출시
- **개발팀 협업 도구**: 테스트 결과 기반 자동 코드 리뷰 및 개선 제안
- **오픈소스 기여**: 게임 개발 커뮤니티에 테스트 자동화 도구 제공

이러한 테스트 시스템의 진화는 Sweet Puzzle 게임의 품질 향상뿐만 아니라, 게임 개발 업계 전체의 테스트 자동화 발전에 기여할 것입니다.